/*
 * Top level DTS file for CVM:P2888-0001 and CVB:P2822-0000.
 *
 * Copyright (c) 2017, NVIDIA CORPORATION.  All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; version 2 of the License.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 * more details.
 */

#include "dt-bindings/extcon-ids.h"
#include "common/tegra194-p2888-0000-a00.dtsi"
#include "common/tegra194-p2822-0000-a00.dtsi"
#include "common/tegra194-power-tree-p2888-0001-p2822-1000.dtsi"
#include "t19x-common-platforms/tegra194-comms.dtsi"

/ {
	nvidia,dtsfilename = __FILE__;

	chosen {
		bootargs ="console=ttyS2,115200 earlycon=uart8250,mmio32,0x0c280000";
		stdout-path = &uartc;
		board-has-eeprom;
	};

	firmware {
		android {
			compatible = "android,firmware";
			hardware = "galen";
			bootmode = "shell";
		};
	};

	arm64_ras {
		status = "disabled";
	};

	carmel_ras {
		status = "disabled";
	};

	cbbnocaxi@2300000 {
		status = "disabled";
	};

	spi@3210000 {
		status = "okay";
	};

	spi@c260000 {
		status = "okay";
	};

	spi@3230000 {
		status = "okay";
	};

	pcie_common {
		status = "okay";

		nvidia,xbar = <1>;
	};

	pcie_c0_rp {
		status = "okay";

		vddio-pex-ctl-supply = <&p2888_spmic_sd3>;

		phys = <&p2u_2>,
		       <&p2u_3>,
		       <&p2u_4>,
		       <&p2u_5>;
		phy-names = "pcie-p2u-0", "pcie-p2u-1", "pcie-p2u-2", "pcie-p2u-3";
	};

	pcie_c1_rp {
		status = "okay";

		vddio-pex-ctl-supply = <&p2888_spmic_sd3>;

		phys = <&p2u_0>;
		phy-names = "pcie-p2u-0";
	};

	pcie_c3_rp {
		status = "okay";

		vddio-pex-ctl-supply = <&p2888_spmic_sd3>;

		phys = <&p2u_7>;
		phy-names = "pcie-p2u-0";
	};

	pcie_c5_rp {
		status = "okay";

		vddio-pex-ctl-supply = <&p2888_spmic_sd3>;

		phys = <&p2u_12>,
		       <&p2u_13>,
		       <&p2u_14>,
		       <&p2u_15>,
		       <&p2u_16>,
		       <&p2u_17>,
		       <&p2u_18>,
		       <&p2u_19>;

		phy-names = "pcie-p2u-0", "pcie-p2u-1", "pcie-p2u-2", "pcie-p2u-3",
					"pcie-p2u-4", "pcie-p2u-5", "pcie-p2u-6", "pcie-p2u-7";
	};

	pmc@c370000 {
		nvidia,invert-interrupt;
	};

	external-connection {
		vbus_id_extcon: extcon@1 {
			compatible = "extcon-gpio-states";
			reg = <0x1>;
			extcon-gpio,name = "VBUS_ID";
			extcon-gpio,wait-for-gpio-scan = <0>;
			extcon-gpio,cable-states = <0x3 0x0
							0x0 0x2
							0x1 0x2
							0x2 0x1>;
			extcon-gpio,out-cable-names = <EXTCON_USB EXTCON_USB_HOST EXTCON_NONE>;
			cable-connected-on-boot = <0>;
			#extcon-cells = <1>;
		};
	};

#if TEGRA_XUSB_PADCONTROL_VERSION >= DT_VERSION_2

	xusb_padctl: xusb_padctl@3520000 {
		status = "okay";

		pads {
			usb2 {
				lanes {
					usb2-0 {
						nvidia,function = "xusb";
						status = "okay";
					};
					usb2-1 {
						nvidia,function = "xusb";
						status = "okay";
					};
					usb2-2 {
						nvidia,function = "xusb";
						status = "okay";
					};
					usb2-3 {
						nvidia,function = "xusb";
						status = "okay";
					};
				};
			};
			usb3 {
				lanes {
					usb3-0 {
						nvidia,function = "xusb";
						status = "okay";
					};
					usb3-2 {
						nvidia,function = "xusb";
						status = "okay";
					};
					usb3-3 {
						nvidia,function = "xusb";
						status = "okay";
					};
				};
			};
		};

		ports {
			usb2-0 {
				mode = "otg";
				status = "okay";
			};
			usb2-1 {
				mode = "host";
				status = "okay";
			};
			usb2-2 {
				mode = "host";
				status = "okay";
			};
			usb2-3 {
				mode = "host";
				status = "okay";
			};
			usb3-0 {
				nvidia,usb2-companion = <1>;
				status = "okay";
			};
			usb3-2 {
				nvidia,usb2-companion = <0>;
				status = "okay";
			};
			usb3-3 {
				nvidia,usb2-companion = <3>;
				status = "okay";
			};
		};
	};
#endif

	tegra_xudc: xudc@3550000 {
		extcon-cables = <&vbus_id_extcon 0>;
		extcon-cable-names = "vbus";
		#extcon-cells = <1>;
#if TEGRA_XUSB_PADCONTROL_VERSION >= DT_VERSION_2
		phys = <&{/xusb_padctl@3520000/pads/usb2/lanes/usb2-0}>,
			<&{/xusb_padctl@3520000/pads/usb3/lanes/usb3-2}>;
		phy-names = "usb2", "usb3";
		nvidia,xusb-padctl = <&xusb_padctl>;
#endif
		status = "okay";
	};

	tegra_xhci: xhci@3610000 {
		extcon-cables = <&vbus_id_extcon 1>;
		extcon-cable-names = "id";
		#extcon-cells = <1>;
#if TEGRA_XUSB_PADCONTROL_VERSION >= DT_VERSION_2
		phys = <&{/xusb_padctl@3520000/pads/usb2/lanes/usb2-0}>,
			<&{/xusb_padctl@3520000/pads/usb2/lanes/usb2-1}>,
			<&{/xusb_padctl@3520000/pads/usb2/lanes/usb2-3}>,
			<&{/xusb_padctl@3520000/pads/usb2/lanes/usb2-2}>,
			<&{/xusb_padctl@3520000/pads/usb3/lanes/usb3-2}>,
			<&{/xusb_padctl@3520000/pads/usb3/lanes/usb3-0}>,
			<&{/xusb_padctl@3520000/pads/usb3/lanes/usb3-3}>;
		phy-names = "usb2-0", "usb2-1", "usb2-3", "usb2-2",
			"usb3-2", "usb3-0", "usb3-3";
		nvidia,xusb-padctl = <&xusb_padctl>;
#endif
		status = "okay";
	};
};

/* Last include for status overrides */
#include "tegra194-p2888-0001-p2822-0000-minimal.dtsi"
